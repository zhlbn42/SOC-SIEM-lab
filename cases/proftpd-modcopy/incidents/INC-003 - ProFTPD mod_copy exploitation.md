INC-003 — ProFTPD mod_copy exploitation (SITE CPFR / SITE CPTO)
# ProFTPD mod_copy exploitation attempt

## Summary
During lab testing I intentionally initiated an attack against a vulnerable
ProFTPD service on Metasploitable3 using the mod_copy functionality.
The goal was to simulate a realistic exploitation attempt and then detect it
from the SIEM side as a SOC analyst.

The activity was identified by observing abnormal FTP commands
`SITE CPFR` and `SITE CPTO`, which are not part of normal FTP usage
and are commonly associated with mod_copy exploitation.

---

## Environment
- Host: metasploitable3-ub1404
- Service: ProFTPD (mod_copy enabled)
- Attacker host: Kali Linux
- Attacker IP: 192.168.56.104
- Log pipeline: rsyslog → Logstash (UDP/5514) → Elasticsearch → Kibana
- Index pattern: metasploitable-*

---

## Attack initiation
I manually executed the attack from Kali Linux by interacting with the FTP
service and issuing `SITE CPFR` and `SITE CPTO` commands to copy files
from a writable directory into the web root.

The attack was performed intentionally to validate visibility, detection,
and alerting capabilities of the SIEM pipeline.

---

## Detection and investigation

### Initial discovery
During investigation in Kibana Discover, I noticed FTP log entries containing
the commands `SITE CPFR` and `SITE CPTO`.

KQL used:


message:("SITE CPFR" or "SITE CPTO")


This immediately stood out as suspicious because these commands are rarely
used in legitimate environments.

---

### Noise reduction
While analyzing the logs, I identified a large amount of background traffic
generated by the web application (`read_log.php`), which was responsible
for more than 90% of the total log volume.

To reduce noise and focus on meaningful security events, I excluded this
background activity using KQL filtering.

KQL after noise reduction:


message:("SITE CPFR" or "SITE CPTO")
AND NOT message:"/chat/read_log.php"


As a result, the attack-related events became clearly visible among thousands
of benign log entries.

---

## Detection rule
Based on the investigation, I created a custom detection rule in Elastic SIEM.

- Rule name: FTP ProFTPD mod_copy exploitation attempt
- Severity: Critical
- Risk score: 99
- Rule type: Custom query

KQL:


message:("SITE CPFR" or "SITE CPTO")
AND NOT message:"/chat/read_log.php"


The rule successfully generated alerts when the exploitation commands
were executed again.

---

## Alerts
The detection rule triggered multiple Critical alerts corresponding to the
mod_copy exploitation activity.

Alerts confirmed:
- Presence of protocol-level exploitation commands
- External source initiating the activity
- High confidence malicious behavior

---

## Impact
If this activity occurred in a real environment, it could allow an attacker
to copy arbitrary files and potentially achieve remote code execution
through the web server.

---

## SOC response actions
If this were a production incident, I would:
- Verify whether FTP service is required on the host
- Inspect copied files and affected directories
- Disable the mod_copy module if not strictly required
- Upgrade ProFTPD to a patched version
- Continue monitoring for follow-up web or shell activity

---

## Result
By applying KQL filtering and tuning log visibility, I was able to isolate
critical mod_copy exploitation activity (SITE CPFR / SITE CPTO) from a large
amount of background noise.

This allowed reliable detection and alerting of the attack despite high
log volume from the application layer.